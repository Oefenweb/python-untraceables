language: python

python:
  - "2.7"

services:
  - mysql

before_install:
  - mysql -uroot -e 'CREATE DATABASE IF NOT EXISTS `untraceables_test`;'
  - mysql -uroot -e "CREATE USER 'untraceables'@'localhost' IDENTIFIED BY 'mmRXHqnc3zSshYjxSv8n';"
  - mysql -uroot -e "GRANT ALL PRIVILEGES ON untraceables_test . * TO 'untraceables'@'localhost';"
  - mysql -uroot -D untraceables_test -e 'CREATE TABLE `users` (`id` int(10) unsigned NOT NULL, `mapped_id` int(10) unsigned NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `mapped_id` (`mapped_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;';
  - mysql -uroot -D untraceables_test -e 'INSERT INTO `users` (`id`, `mapped_id`) VALUES (0, 10), (1, 9), (2, 8);';

install: make init-dev

before_script:
  - export PYTHONPATH="${PYTHONPATH}:$(pwd)"

script:
  - make check
  - make test
  - make source
  - pip install --upgrade dist/untraceables-*.tar.gz

notifications:
  email: false
  hipchat:
    rooms:
      secure: X5mHSHzsNBgQNKnwIFuSzagSHUqyPLGWL1SW6aMHRd4WtdAEtfN3w+iyvT1s0v7F4p9xZc3PEzV8WbXtsELkDEnYvLyucS8MVMQJ1ohuDig32t4TIwMnEZF0IyhDTlUtG31wnLWxxM0Kmx+/6xrg7I9tx2EA0w2opof2K1cHBVARFEq/sFBF/bOthLfR9dM4paAkELZMgg/CsK4T9S9SWo4NsvwUbP3bWV3Gh6dYF3g5nd7DhqxUvusL9oMu5JXA5U4H7dCB7aQRAjg12Fdg/F/ZJelVT+Deg3zGHep8zTEr4ykVWpoVko6VK9+Jh8WSnazG7XCEMNNatmR48CTXuoj5axLTjP0yyfeniauIFwapO3jaf+Vn/HOAa3xNQz/MBg24J9P74CCeYDJ18uu5WqcNetpw/re4N6edPGWBfbk332JoMvPU47RlX24n6rxghO62zA4wf/uohmeEdqxlDIfeofPeCKBuxeMT/wAVKxFB75fmBlrAQcGQuVgvfRLOEUb1ONTFsl4RaTSIRsxFivRCWp5jUeUp4BxYYKpFKhBawIvaFQtriy/PbTZUBlBmOATGmpAL/bgmfuEWKTZ8uVJYkj/VoI36C6hqWbzJKuxzWn7tFeeQC2dcSpdhZx7aacdhEGYlv00v9X+AIXSGxNhQIIraGkEsvqqj2F2kag4=
